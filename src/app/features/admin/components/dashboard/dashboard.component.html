<div class="dashboard-wrapper">
  <div class="magic-blob blob-top"></div>
  <div class="magic-blob blob-bottom"></div>
  <div class="sparkle-overlay"></div>

  <div class="dashboard-container">

    <header class="dash-header fade-in">
      <div class="greeting-box">
        <span class="crown">ğŸ‘‘</span>
        <div class="greeting-text">
          <h1>Hola, Reina</h1>
          <p class="subtitle">Tu imperio rosa estÃ¡ brillando hoy âœ¨</p>
        </div>
      </div>
      <div class="date-badge">
        <span class="bow">ğŸ€</span> {{ today | date:'EEEE d MMMM' }}
      </div>
    </header>

    @if (loading()) {
    <div class="loading-state">
      <div class="spinner">ğŸ€</div>
      <p>Preparando la magia...</p>
    </div>
    } @else {
    @if (data(); as d) {

    <div class="kpi-row fade-in delay-1">
      <div class="kpi-card glass-card">
        <div class="kpi-icon-wrap bg-pink">ğŸŒ¸</div>
        <div class="kpi-data">
          <span class="kpi-label">Ventas Hoy</span>
          <span class="kpi-value">{{ metrics().salesToday | currency:'MXN':'symbol-narrow':'1.0-0' }}</span>
        </div>
      </div>
      <div class="kpi-card glass-card">
        <div class="kpi-icon-wrap bg-peach">ğŸ“…</div>
        <div class="kpi-data">
          <span class="kpi-label">Este Mes</span>
          <span class="kpi-value">{{ metrics().salesMonth | currency:'MXN':'symbol-narrow':'1.0-0' }}</span>
        </div>
      </div>
      <div class="kpi-card glass-card alert-card">
        <div class="kpi-icon-wrap bg-red">ğŸ’¸</div>
        <div class="kpi-data">
          <span class="kpi-label">PENDIENTE</span>
          <span class="kpi-value text-red">{{ metrics().pendingCollection | currency:'MXN':'symbol-narrow':'1.0-0'
            }}</span>
        </div>
      </div>
      <div class="kpi-card glass-card">
        <div class="kpi-icon-wrap bg-blue">ğŸš—</div>
        <div class="kpi-data">
          <span class="kpi-label">Rutas</span>
          <span class="kpi-value">{{ d.activeRoutes }} Activas</span>
        </div>
      </div>
    </div>

    <div class="stats-grid fade-in delay-2">

      <div class="stat-card glass-card accent-border-pink">
        <div class="stat-header">
          <div class="title-group">
            <span class="emoji">ğŸ›ï¸</span>
            <span class="trend">Tus Pedidos</span>
          </div>
        </div>
        <div class="flex-row-between mt-2">
          <span class="stat-number">{{ d.totalOrders }}</span>
          <div class="mini-tags">
            <span class="cute-tag pending">â³ {{ d.pendingOrders }} Pends.</span>
            <span class="cute-tag success">ğŸ’ {{ d.deliveredOrders }} Entreg.</span>
          </div>
        </div>
      </div>

      <div class="stat-card glass-card accent-border-purple">
        <div class="stat-header">
          <div class="title-group">
            <span class="emoji">ğŸ’…</span>
            <span class="trend">El Imperio</span>
          </div>
        </div>
        <div class="flex-row-between mt-2">
          <div class="flex-col truncate-safe">
            <span class="kpi-label">Clientas</span>
            <span class="stat-number text-purple-700">{{ d.totalClients }}</span>
          </div>
          <div class="flex-col text-right truncate-safe">
            <span class="kpi-label">InversiÃ³n (HistÃ³rica)</span>
            <span class="stat-number text-lg text-pink-500">${{ d.totalInvestment | number:'1.0-0' }}</span>
          </div>
        </div>
      </div>

      <div class="stat-card glass-card accent-border-peach wide-card">
        <div class="stat-header">
          <div class="title-group">
            <span class="emoji">ğŸ’³</span>
            <span class="trend">La Billetera MÃ¡gica</span>
          </div>
        </div>
        <div class="payment-methods-row">
          <div class="pay-method">
            <span class="kpi-label">ğŸ’µ Efectivo</span>
            <span class="pay-amount text-pink-600">${{ d.totalCashAmount | number:'1.0-0' }}</span>
            <span class="pay-count">({{ d.totalCashOrders }} uds)</span>
          </div>
          <div class="pay-divider"></div>
          <div class="pay-method">
            <span class="kpi-label">ğŸ“± Transf.</span>
            <span class="pay-amount text-purple-600">${{ d.totalTransferAmount | number:'1.0-0' }}</span>
            <span class="pay-count">({{ d.totalTransferOrders }} uds)</span>
          </div>
          <div class="pay-divider"></div>
          <div class="pay-method">
            <span class="kpi-label">ğŸ¦ DepÃ³sito</span>
            <span class="pay-amount text-blue-600">${{ d.totalDepositAmount | number:'1.0-0' }}</span>
            <span class="pay-count">({{ d.totalDepositOrders }} uds)</span>
          </div>
        </div>
      </div>

    </div>

    <div class="charts-grid fade-in delay-3">
      <div class="chart-card glass-card wide">
        <h3>ğŸ“ˆ Crecimiento del mes</h3>
        <div class="chart-wrapper">
          <div echarts [options]="salesVsInvOptions" class="echart-instance"></div>
        </div>
      </div>

      <div class="chart-card glass-card">
        <h3>ğŸ€ Tipos de Clientas</h3>
        <div class="chart-wrapper">
          <div echarts [options]="clientTypeOptions" class="echart-instance"></div>
        </div>
      </div>

      <div class="chart-card glass-card">
        <h3>ğŸšš EnvÃ­os vs PickUp</h3>
        <div class="chart-wrapper">
          <div echarts [options]="deliveryMethodOptions" class="echart-instance"></div>
        </div>
      </div>
    </div>

    }
    }
  </div>
</div>